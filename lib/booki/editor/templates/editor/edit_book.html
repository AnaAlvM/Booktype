{% extends "base.html" %}

{% block header %}

<link type="text/css" href="/site_media/css/editor.css" rel="Stylesheet" />
<script type="text/javascript" src="/site_media/js/editor.js"></script>

        <script type="text/javascript">
	$(function() {


	    /* booki part */
            /* this is temporary here */

           $.booki.username = "{{request.user.username}}";
           $.booki.currentProjectID = {{project.id}};
           $.booki.currentProject = "{{project.name}}";
           $.booki.currentBookID  = {{book.id}};
           $.booki.currentBook    = "{{book.title}}";

	    /* call when page is loaded */

	    $.booki.editor.initEditor();


            $.booki.subscribeToChannel("/booki/", function(message) {

            });


// this should be in editor.js
        $("#formchapter  BUTTON.submit").click(function() {
                  $.booki.ui.notify("Creating chapter");
 
                   $.booki.sendToChannel("/booki/book/"+$.booki.currentProjectID+"/"+$.booki.currentBookID+"/", {"command": "create_chapter", "chapter": $("#formchapter INPUT.chapter").val()}, function(data) {
                           $.booki.ui.notify();
                           $("#formchapter INPUT.chapter").val("");
                      });

          });

        $("#formsection  BUTTON.submit").click(function() {
                  $.booki.ui.notify("Creating section");
 
                   $.booki.sendToChannel("/booki/book/"+$.booki.currentProjectID+"/"+$.booki.currentBookID+"/", {"command": "create_section", "chapter": $("#formsection INPUT.chapter").val()}, function(data) {
                           $.booki.ui.notify();
                           $("#formsection INPUT.chapter").val("");
                      });

          });


	    // open debug window
	    $.booki.debug.init();

	    $("#header .debug").click(function() {
		$("#bookidebug").dialog("open");
		return false;
	    });

          // start Sputnik
          jQuery.booki.network._transport.connect();
	    
	    // $("#datepicker").datepicker({"onSelect": function(a) { alert(a)}});

	});

                 </script>

<script type="text/javascript">
  var _editor_url = "/site_media/xinha/";
  var _editor_lang = "en";
</script>
<script type="text/javascript" src="/site_media/xinha/XinhaCore.js"></script>
<script type="text/javascript">

var xinha_plugins =
[
 'GetHtml',        'SaveSubmit', 'DoubleClick', 'ImageManager', 'SpellChecker'
];
var xinha_editors =
[
  'myTextArea'
];


var prvi = false;

function xinha_init()
{
  if(!Xinha.loadPlugins(xinha_plugins, xinha_init)) return;

  if(prvi) return;

    var xinha_config = new Xinha.Config();

/*
    xinha_config.width  = '670px';
    xinha_config.height = '600px';
*/
    xinha_config.pageStyle = 'body {font-family : trebuchet,verdana, sans-serif; font-size: 12px; line-height:17px;}' + 'h1 {font-size: 24px;font-family : Arial,verdana, sans-serif; font-weight : Bold; margin-bottom: 10px;  margin-top: 0px; line-height: 32px;  letter-spacing: -1px; }' + 'h2 {font-size: 18px; font-family : Arial,verdana, sans-serif; font-weight : Bold; margin-bottom: 10px; margin-top: 15px; padding-top : 15px;}' + 'h3 {font-size: 14px;font-family : Arial,verdana, sans-serif;font-weight : Bold;margin-bottom: 5px; }' + 'pre { font-size:12px; line-height:1.5em; background-color:#FFE5CC; border: 0px solid #000000; margin-left : 0.5em; margin-bottom : 20px; margin-right : 1em; padding-left: 1em; padding-right: 1em; padding-top: 0.2em; padding-bottom: 0.2em; color : black; white-space: pre-wrap; white-space: -moz-pre-wrap;white-space: -pre-wrap;white-space: -o-pre-wrap; word-wrap: break-word;}' + 'ul, li {margin-bottom: 5px; margin-top: 0px;}';

    xinha_config.toolbar = [["popupeditor"],["formatblock","bold","italic"],["separator","insertorderedlist","insertunorderedlist"],["separator","createlink","insertimage","inserttable"],(Xinha.is_gecko?[]:["cut","copy","paste","overwrite","saveas"]),["separator","removeformat","killword"],["separator","htmlmode","showhelp","about"]];




    xinha_editors = Xinha.makeEditors(xinha_editors, xinha_config, xinha_plugins);

    Xinha.startEditors(xinha_editors);
    prvi = true;


}

//Xinha.addOnloadHandler(xinha_init);
</script>


{% endblock %}

{% block content %}
<div id="notify">
some notification. this should be on top of visible page and not top of page.
</div>

<div id="bookidebug">
</div>

<div id="header">
 <div style="float:right; font-size: 12px">
    <a href="/accounts/{{ request.user.username }}/">{{ request.user.username }}</a> | <a class="debug" href="javascript:void(0)">Debug</a> | <a href="/accounts/signout/">Sign out</a>

<!--    <a href="/accounts/{{ request.user.username }}/">{{ request.user.username }}</a> | <a href="">Settings</a> | <a href="">Help</a> | <a class="debug" href="javascript:void(0)">Debug</a> | <a href="/accounts/signout/">Sign out</a> -->

 </div>
</div>

<br clear="all"/>

<div>
<div style="float: right; padding-top: 5px">
<form>
<input type="text" size="20"> <button>Search</button>
</form>
</div>
<h1 style="margin-top: 0px"> <a href="/{{ project.url_name }}/{{ book.url_title }}/">{{ book }}</a> </h1>
</div>

<div id="tabs">
	<ul>
		<li><a href="#tabchapters">Chapters</a></li>
		<li><a href="#tabinfo">Info</a></li>
<!--		<li><a href="#tabbigchat">Chat</a></li>  -->
		<li><a href="#tabpublish">Publish</a></li>

	</ul>
	<div id="tabchapters">



<table border="0" width="100%">
<tr>
<td valign="top">
<div id="container">

<h2>Table of contents</h2>

<ul id="chapterslist" class="connectedSortable">
</ul>


<h2>Hold chapters</h2>
<ul id="holdchapterslist" class="connectedSortable">
</ul>

<div style="border-bottom: 1px solid #c0c0c0; padding-top: 50px; margin-bottom: 20px"></div>
This is temporary interface. 
<div id="formchapter">
<h2>Create new chapter</h2>
<form method="GET" action="javascript:void(0)" onsubmit="return false">
<input class="chapter" type="text" size="30"><button class="submit">Create chapter</button>
</form>
</div>

<div id="formsection">
<h2>Create new section</h2>
<form method="GET" action="javascript:void(0)" onsubmit="return false">
<input class="chapter" type="text" size="30"><button class="submit">Create section</button>
</form>
</div>

</div>

<div id="editor" style="display: none">
<form method="GET" action="javascript: return void(0)">
<input type="hidden" name="chapter_id" value=""/>
<input type="button" class="save" name="save" value="Save"/>
<button class="cancel">Cancel</button>
<br/>
<input type="text" name="title" style="width: 500px">
<br/>
<textarea name="myTextArea" id="myTextArea" style="width: 500px; height: 600px">
</textarea>
</form>
</div>

</td>
<td valign="top" width="200">
<h4>Chat</h4>
<div id="chat">
</div>

<h4>Active sessions (debug)</h4>
 <div id="users">
 </div>
<!--
                <div id="accordion">
                        <div>                                <h3><a href="#">Info</a></h3>
                                <div>Info about book status and etc.</div>
                        </div>
                        <div>
                                <h3><a href="#">Tools</a></h3>
                                <div>Create new chapter</div>
                        </div>
                        <div>
                                <h3><a href="#">Users</a></h3>
                                <div>Current users...</div>
                        </div>
                </div>
-->

</td>
</tr>
</table>


	</div>

<!--
<div id="tabbigchat">
<table border="0">
<tr>
<td width="100%">
<div id="chat2">
</div>
</td>
<td width="20"></td>
<td valign="top">
<h4>Search conversations</h4>
<form>
<input type="text" style="width:  200px">
</form>
<h4>Conversation history</h4>
<div id="datepicker" ></div>

</td>
</tr>
</table>

</div>
-->

	<div id="tabinfo">
           Title:<br/>
           Creator:<br/>
           Maintainer:<br/>
           Date Created:<br/>
           Licence:<br/>
           About:<br/>

           <br/>
           <span style="font-style: italic; color: #d0d0d0">This part of UI is still not functional. We have to finish book import first.</span>
	</div>

	<div id="tabpublish">
          <h1>Publish</h1>
          <p>Some options could go here.</p>
          <form method="" action="">
            <button>Publish this book</button>
          </form>
          <br/>
          <span style="font-style: italic; color: #d0d0d0">This part of UI is still not functional. We have to finish book export first.</span>

	</div>


</div>



{% endblock %}
